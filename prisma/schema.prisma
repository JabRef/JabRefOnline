// After changing this file, run yarn prisma:migrate:dev to push the changes to the database

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id String @id @default(cuid())
  email String @unique
  emailIsVerified Boolean @default(false)
  name String?
  password String
  createdAt DateTime @default(now())
  documents UserDocument[]
  groups Group[]
}

// Articles, books etc added by users
// We do not know what users put in their fields, thus we assume everything is a string
model UserDocument {
  id String @id @default(cuid())
  users User[]

  type String
  citationKey String?

  lastModified DateTime?
  added DateTime?

  // Common fields
  author String?
  editor String?
  title String?
  journal String?
  journaltitle String?
  booktitle String?
  date String?
  year String?
  month String?
  number String?
  volume String?
  edition String?
  series String?
  pages String?
  pagetotal String?
  issue String?
  note String?
  url String?
  urldate String?
  publisher String?
  abstract String?
  keywords String?

  // JabRef-specific
  explicitGroups Group[]
  priority String?

  // Identifier
  doi String?
  eprint String?
  eprintclass String?
  eprinttype String?
  issn String?
  isbn String?

  // Other fields that are not often used
  other UserDocumentOtherField[]
}

model UserDocumentOtherField {
  document UserDocument @relation(fields: [documentId], references: [id])
  documentId String
  field String
  value String

  @@id([documentId, field])
}

enum GroupHierarchyType {
  /// The group's content is independent of its hierarchical position.
  INDEPENDENT

  /// The group's content is the intersection of its own content with its supergroups' content.
  INTERSECTION

  /// The group's content is the union of its own content with its subgroups' content.
  UNION
}

enum GroupType {
  AutomaticKeywordGroup
  AutomaticPersonsGroup
  ExplicitGroup
  LastNameGroup
  WordKeywordGroup
  RegexKeywordGroup
  SearchGroup
  TexGroup
}

model Group {
  id String @id @default(cuid())
  users User[]
  name String
  displayName String
  parentId String?
  parent Group? @relation("GroupTree", fields: [parentId], references: [id])
  children Group[] @relation("GroupTree")

  hierarchyType GroupHierarchyType
  color String?
  description String?
  icon String?
  isExpanded Boolean

  // Prisma currently does not support union types / inheritance (https://github.com/prisma/prisma/issues/2505)
  // Thus, we assemble all possible fields from all types of groups here
  type GroupType
  explicitDocuments UserDocument[]
  field String?
  keywordDelimiter String?
  keywordHierarchicalDelimiter String?
  authorLastName String?
  searchExpression String?
  caseSensitive Boolean?
  onlySplitWordsAtDelimiter Boolean?
  isRegEx Boolean?
}
